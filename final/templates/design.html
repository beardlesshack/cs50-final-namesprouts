{% extends "layout.html" %}
{% block content %}

<h1>Create Your Name Flower</h1>

<form method="POST" action="{{ url_for('design') }}">
<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <label for="nameInput">Name</label>
    <input
        type="text"
        id="nameInput"
        name="name"
        placeholder="Enter a name"
        required
        autocomplete="off"
    >

    <label for="monthSelect">Birth Month</label>
    <select id="monthSelect" name="month" required>
        <option value="">Select month</option>
        <option value="january">January</option>
        <option value="february">February</option>
        <option value="march">March</option>
        <option value="april">April</option>
        <option value="may">May</option>
        <option value="june">June</option>
        <option value="july">July</option>
        <option value="august">August</option>
        <option value="september">September</option>
        <option value="october">October</option>
        <option value="november">November</option>
        <option value="december">December</option>
    </select>

    <div class="preview-controls">
        <button type="button" id="previewButton">Preview</button>
        <button type="submit">Save Project</button>
    </div>

</form>

<!-- PREVIEW AREA -->
<div class="preview-area" aria-live="polite">

    <img
        id="flowerImg"
        src="/static/flowers/default.png"
        alt="Flower preview"
    >

    <div id="stemLetters" class="stem-letters"></div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const nameInput = document.getElementById("nameInput");
    const monthSelect = document.getElementById("monthSelect");
    const previewButton = document.getElementById("previewButton");
    const flowerImg = document.getElementById("flowerImg");
    const stemLetters = document.getElementById("stemLetters");

    function updatePreview() {

        const rawName = nameInput.value.trim();

        // Reset preview if empty
        if (!rawName) {
            stemLetters.innerHTML = "";
            flowerImg.src = "/static/flowers/default.png";
            return;
        }

        stemLetters.innerHTML = "";

        // Normalize: letters only for preview
        const letters = rawName.replace(/[^a-zA-Z]/g, "").split("");

        if (!letters.length) return;

        // Bottom stem letter (lowercase)
        const bottomSpan = document.createElement("div");
        bottomSpan.classList.add("stem-letter", "stem-start");
        bottomSpan.textContent = letters[0].toLowerCase();
        stemLetters.appendChild(bottomSpan);

        // Remaining letters (bottom â†’ top)
        letters.slice(1).reverse().forEach(char => {
            const span = document.createElement("div");
            span.classList.add("stem-letter");
            span.textContent = char;
            stemLetters.appendChild(span);
        });

        // Flower image by month
        if (monthSelect.value) {
            flowerImg.src = `/static/flowers/${monthSelect.value}.png`;
            flowerImg.onerror = () => {
                flowerImg.src = "/static/flowers/default.png";
            };
        }
    }

    nameInput.addEventListener("input", updatePreview);
    monthSelect.addEventListener("change", updatePreview);
    previewButton.addEventListener("click", updatePreview);

});
</script>

{% endblock %}


